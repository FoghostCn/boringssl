{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "4631b938_d243b0d5",
        "filename": "crypto/x509/x509_vfy.c",
        "patchSetId": 3
      },
      "lineNbr": 449,
      "author": {
        "id": 14196
      },
      "writtenOn": "2024-01-02T23:00:49Z",
      "side": 1,
      "message": "```suggestion\n  switch(ok) {\n     case 0:\n        ctx-\u003eerror \u003d (ctx-\u003eerror !\u003d X509_V_OK) ? ctx-\u003eerror : X509_V_ERR_UNSPECIFIED;\n        break;\n     case 1:\n        break;\n     default:\n        abort(); // NOTREACHED\n   }\n```",
      "range": {
        "startLine": 447,
        "startChar": 0,
        "endLine": 449,
        "endChar": 3
      },
      "revId": "a234928ec0ffcfe6d90d64c50036ba8e53ff03a7",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6efd941d_d86e2c1c",
        "filename": "crypto/x509/x509_vfy.c",
        "patchSetId": 3
      },
      "lineNbr": 449,
      "author": {
        "id": 5415
      },
      "writtenOn": "2024-01-03T01:33:02Z",
      "side": 1,
      "message": "`ok` is never set to the output of `verify_cb` after this change. It cannot be -1. That was the point of this CL. :-P The only assignments are the ones that initialize it to 0, and then line 440.\n\nIt\u0027s really just `bool` now. :-)",
      "parentUuid": "4631b938_d243b0d5",
      "range": {
        "startLine": 447,
        "startChar": 0,
        "endLine": 449,
        "endChar": 3
      },
      "revId": "a234928ec0ffcfe6d90d64c50036ba8e53ff03a7",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "329bc924_86cc719e",
        "filename": "crypto/x509/x509_vfy.c",
        "patchSetId": 3
      },
      "lineNbr": 449,
      "author": {
        "id": 14196
      },
      "writtenOn": "2024-01-03T17:43:05Z",
      "side": 1,
      "message": "The problem here is before, ok could potentially be assigned to as the value of the callback, Fall through to here, and hit the safety net. \n\nwe would not have added the unconditional ok\u003d1 at line 440 as we do now, \n\nat that point a negative return value from the callback is caught by this safety net to ensure that an X509_V_OK is *never* returned from here, which\nis what the callers actually check for. \n\nwhat we have potentially done now is map -1 to a 1 return (still yes, a non-zero return) but we will now potentially return X509_V_0K from -1 which we did not before. as we have turned this into a boolean mapping -1 to 1, and lost the \u003c\u003d 0 check on this fallback. \n\nSo yes, my suggestion is wrong, and you\u0027re correct, within this function it is now simply a boolean. my concern here is the loss of the -1 check with the change above this. before a -1 return value would return non-zero, but not have X509_V_OK set.. Now it can have X509_V_OK set.",
      "parentUuid": "6efd941d_d86e2c1c",
      "range": {
        "startLine": 447,
        "startChar": 0,
        "endLine": 449,
        "endChar": 3
      },
      "revId": "a234928ec0ffcfe6d90d64c50036ba8e53ff03a7",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "80708c4e_a6ad3d8c",
        "filename": "crypto/x509/x509_vfy.c",
        "patchSetId": 3
      },
      "lineNbr": 449,
      "author": {
        "id": 5415
      },
      "writtenOn": "2024-01-03T18:38:59Z",
      "side": 1,
      "message": "Chatted out-of-band. Summarizing for posterity:\n\nThe disconnect was I wasn\u0027t thinking about a verify_cb that just always returned -1. In that case, even though we internally read as success, we would leak that -1 into ok and then this \"safety net\" would cause it to return (-1, ERR_UNSPECIFIED) and read as a failure to the caller.\n\nPlan is to, before this CL, do:\n1. Get rid of the ok\u003d2 case from NOTIFY_POLICY because no one uses it\n2. Surround all verify_cb calls with a wrapper that does aborts if the caller returns anything other than 0 or 1, because -1 was ambiguous\n3. Run that through tests to make sure nothing notices\n4. Land this guy",
      "parentUuid": "329bc924_86cc719e",
      "range": {
        "startLine": 447,
        "startChar": 0,
        "endLine": 449,
        "endChar": 3
      },
      "revId": "a234928ec0ffcfe6d90d64c50036ba8e53ff03a7",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b9571930_1d731677",
        "filename": "crypto/x509/x509_vfy.c",
        "patchSetId": 3
      },
      "lineNbr": 449,
      "author": {
        "id": 14196
      },
      "writtenOn": "2024-01-03T19:24:42Z",
      "side": 1,
      "message": "I am much more comfortable with this approach :)",
      "parentUuid": "80708c4e_a6ad3d8c",
      "range": {
        "startLine": 447,
        "startChar": 0,
        "endLine": 449,
        "endChar": 3
      },
      "revId": "a234928ec0ffcfe6d90d64c50036ba8e53ff03a7",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1e1fe2c9_d224f7be",
        "filename": "crypto/x509/x509_vfy.c",
        "patchSetId": 3
      },
      "lineNbr": 449,
      "author": {
        "id": 5415
      },
      "writtenOn": "2024-01-05T22:39:00Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "b9571930_1d731677",
      "range": {
        "startLine": 447,
        "startChar": 0,
        "endLine": 449,
        "endChar": 3
      },
      "revId": "a234928ec0ffcfe6d90d64c50036ba8e53ff03a7",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    }
  ]
}