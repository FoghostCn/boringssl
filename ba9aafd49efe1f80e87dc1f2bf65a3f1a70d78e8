{
  "comments": [
    {
      "key": {
        "uuid": "ffce16b2_e4de0776",
        "filename": "ssl/handoff.cc",
        "patchSetId": 3
      },
      "lineNbr": 193,
      "author": {
        "id": 5415
      },
      "writtenOn": "2019-12-09T20:34:11Z",
      "side": 1,
      "message": "Existing issue, but any reason not to move the ssl-\u003eserver check from SSL_serialize_handback into this function so both callers do it?",
      "revId": "ba9aafd49efe1f80e87dc1f2bf65a3f1a70d78e8",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3ef849aa_ce6a931f",
        "filename": "ssl/handoff.cc",
        "patchSetId": 3
      },
      "lineNbr": 193,
      "author": {
        "id": 5645
      },
      "writtenOn": "2019-12-10T21:21:09Z",
      "side": 1,
      "message": "SSL_apply_handoff() calls SSL_set_accept_state().  I believe the thinking was that the \"apply\" functions should operate on pristine objects.  So there isn\u0027t a requirement that |server| be set.",
      "parentUuid": "ffce16b2_e4de0776",
      "revId": "ba9aafd49efe1f80e87dc1f2bf65a3f1a70d78e8",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4a1a7c41_8c17531b",
        "filename": "ssl/handoff.cc",
        "patchSetId": 3
      },
      "lineNbr": 193,
      "author": {
        "id": 5415
      },
      "writtenOn": "2019-12-16T19:05:46Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "3ef849aa_ce6a931f",
      "revId": "ba9aafd49efe1f80e87dc1f2bf65a3f1a70d78e8",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2e9e20fd_8ce35f4a",
        "filename": "ssl/handoff.cc",
        "patchSetId": 3
      },
      "lineNbr": 248,
      "author": {
        "id": 5005
      },
      "writtenOn": "2019-12-09T17:41:03Z",
      "side": 1,
      "message": "// The outer state machine is always in |state12_tls13| for a TLS 1.3 handshake as TLS 1.3 uses |tls13_state|.",
      "revId": "ba9aafd49efe1f80e87dc1f2bf65a3f1a70d78e8",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "03dda72f_6da204b4",
        "filename": "ssl/handoff.cc",
        "patchSetId": 3
      },
      "lineNbr": 248,
      "author": {
        "id": 5645
      },
      "writtenOn": "2019-12-10T21:21:09Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "2e9e20fd_8ce35f4a",
      "revId": "ba9aafd49efe1f80e87dc1f2bf65a3f1a70d78e8",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "198cf248_44280549",
        "filename": "ssl/handoff.cc",
        "patchSetId": 3
      },
      "lineNbr": 256,
      "author": {
        "id": 5005
      },
      "writtenOn": "2019-12-09T17:41:03Z",
      "side": 1,
      "message": "(nit: const after |*| for consistency with previous line.)",
      "revId": "ba9aafd49efe1f80e87dc1f2bf65a3f1a70d78e8",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2fab8a02_30faef07",
        "filename": "ssl/handoff.cc",
        "patchSetId": 3
      },
      "lineNbr": 256,
      "author": {
        "id": 5645
      },
      "writtenOn": "2019-12-10T21:21:09Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "198cf248_44280549",
      "revId": "ba9aafd49efe1f80e87dc1f2bf65a3f1a70d78e8",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "32b29476_973b8c0f",
        "filename": "ssl/handoff.cc",
        "patchSetId": 3
      },
      "lineNbr": 290,
      "author": {
        "id": 5005
      },
      "writtenOn": "2019-12-09T17:41:03Z",
      "side": 1,
      "message": "Should this be an |assert| or is to expected to happen in normal processing?",
      "revId": "ba9aafd49efe1f80e87dc1f2bf65a3f1a70d78e8",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fb017de7_a4cec3df",
        "filename": "ssl/handoff.cc",
        "patchSetId": 3
      },
      "lineNbr": 290,
      "author": {
        "id": 5415
      },
      "writtenOn": "2019-12-09T20:34:11Z",
      "side": 1,
      "message": "I believe at this point we\u0027ll always have dropped ssl-\u003esession in the TLS 1.3 state machine.",
      "parentUuid": "32b29476_973b8c0f",
      "revId": "ba9aafd49efe1f80e87dc1f2bf65a3f1a70d78e8",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "16550222_21f47bd2",
        "filename": "ssl/handoff.cc",
        "patchSetId": 3
      },
      "lineNbr": 290,
      "author": {
        "id": 5645
      },
      "writtenOn": "2019-12-10T21:21:09Z",
      "side": 1,
      "message": "I\u0027ll just remove the check.  I don\u0027t think it serves a purpose any more.",
      "parentUuid": "32b29476_973b8c0f",
      "revId": "ba9aafd49efe1f80e87dc1f2bf65a3f1a70d78e8",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "bc6db4e6_911e7093",
        "filename": "ssl/handoff.cc",
        "patchSetId": 3
      },
      "lineNbr": 356,
      "author": {
        "id": 5415
      },
      "writtenOn": "2019-12-09T20:34:11Z",
      "side": 1,
      "message": "Nit: 80 chars.",
      "revId": "ba9aafd49efe1f80e87dc1f2bf65a3f1a70d78e8",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7613eba9_d640cf19",
        "filename": "ssl/handoff.cc",
        "patchSetId": 3
      },
      "lineNbr": 356,
      "author": {
        "id": 5645
      },
      "writtenOn": "2019-12-10T21:21:09Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "bc6db4e6_911e7093",
      "revId": "ba9aafd49efe1f80e87dc1f2bf65a3f1a70d78e8",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d94848b5_c3514f61",
        "filename": "ssl/handoff.cc",
        "patchSetId": 3
      },
      "lineNbr": 406,
      "author": {
        "id": 5005
      },
      "writtenOn": "2019-12-09T17:41:03Z",
      "side": 1,
      "message": "(nit: maybe |const| after |*| again.)",
      "revId": "ba9aafd49efe1f80e87dc1f2bf65a3f1a70d78e8",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8dee07e0_26feba2a",
        "filename": "ssl/handoff.cc",
        "patchSetId": 3
      },
      "lineNbr": 406,
      "author": {
        "id": 5645
      },
      "writtenOn": "2019-12-10T21:21:09Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "d94848b5_c3514f61",
      "revId": "ba9aafd49efe1f80e87dc1f2bf65a3f1a70d78e8",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ef99ab39_120384d2",
        "filename": "ssl/handoff.cc",
        "patchSetId": 3
      },
      "lineNbr": 458,
      "author": {
        "id": 5005
      },
      "writtenOn": "2019-12-09T17:41:03Z",
      "side": 1,
      "message": "if (ticket_age_skew \u003e INT_MAX) {\n  return false;\n}",
      "revId": "ba9aafd49efe1f80e87dc1f2bf65a3f1a70d78e8",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b9c5672b_160ded7c",
        "filename": "ssl/handoff.cc",
        "patchSetId": 3
      },
      "lineNbr": 458,
      "author": {
        "id": 5415
      },
      "writtenOn": "2019-12-09T20:34:11Z",
      "side": 1,
      "message": "This serialization is odd because ticket_age_skew may be negative. Should we perhaps teach CBS to encode negative ASN.1 integers?",
      "parentUuid": "ef99ab39_120384d2",
      "revId": "ba9aafd49efe1f80e87dc1f2bf65a3f1a70d78e8",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2d478ea1_8b387bdf",
        "filename": "ssl/handoff.cc",
        "patchSetId": 3
      },
      "lineNbr": 458,
      "author": {
        "id": 5645
      },
      "writtenOn": "2019-12-10T21:21:09Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "b9c5672b_160ded7c",
      "revId": "ba9aafd49efe1f80e87dc1f2bf65a3f1a70d78e8",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "744aa22f_2ffa1ca9",
        "filename": "ssl/handoff.cc",
        "patchSetId": 3
      },
      "lineNbr": 461,
      "author": {
        "id": 5415
      },
      "writtenOn": "2019-12-09T20:34:11Z",
      "side": 1,
      "message": "This must also match the hash size. I don\u0027t know off-hand if the TLS 1.3 state machine will explode horribly if they mismatch, but probably prudent to check.",
      "revId": "ba9aafd49efe1f80e87dc1f2bf65a3f1a70d78e8",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b2cfdd06_0f8b672b",
        "filename": "ssl/handoff.cc",
        "patchSetId": 3
      },
      "lineNbr": 461,
      "author": {
        "id": 5645
      },
      "writtenOn": "2019-12-10T21:21:09Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "744aa22f_2ffa1ca9",
      "revId": "ba9aafd49efe1f80e87dc1f2bf65a3f1a70d78e8",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4093b70c_5cc520e2",
        "filename": "ssl/handoff.cc",
        "patchSetId": 3
      },
      "lineNbr": 471,
      "author": {
        "id": 5415
      },
      "writtenOn": "2019-12-09T20:34:11Z",
      "side": 1,
      "message": "s/s3-\u003ehs/hs/g?",
      "range": {
        "startLine": 471,
        "startChar": 11,
        "endLine": 471,
        "endChar": 17
      },
      "revId": "ba9aafd49efe1f80e87dc1f2bf65a3f1a70d78e8",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3b3471d1_0aceebeb",
        "filename": "ssl/handoff.cc",
        "patchSetId": 3
      },
      "lineNbr": 471,
      "author": {
        "id": 5645
      },
      "writtenOn": "2019-12-10T21:21:09Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "4093b70c_5cc520e2",
      "range": {
        "startLine": 471,
        "startChar": 11,
        "endLine": 471,
        "endChar": 17
      },
      "revId": "ba9aafd49efe1f80e87dc1f2bf65a3f1a70d78e8",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "98a82fde_e854e139",
        "filename": "ssl/handoff.cc",
        "patchSetId": 3
      },
      "lineNbr": 484,
      "author": {
        "id": 5415
      },
      "writtenOn": "2019-12-09T20:34:11Z",
      "side": 1,
      "message": "This array has bounded size but is missing a bounds check. I think this is an out-of-bounds write on invalid data right now.\n\nBetter yet, check CBS_len(\u0026exporter_secret) against the size of the hash in the cipher suite.",
      "range": {
        "startLine": 484,
        "startChar": 12,
        "endLine": 484,
        "endChar": 30
      },
      "revId": "ba9aafd49efe1f80e87dc1f2bf65a3f1a70d78e8",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7b1a6944_c4de2e9b",
        "filename": "ssl/handoff.cc",
        "patchSetId": 3
      },
      "lineNbr": 484,
      "author": {
        "id": 5645
      },
      "writtenOn": "2019-12-10T21:21:09Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "98a82fde_e854e139",
      "range": {
        "startLine": 484,
        "startChar": 12,
        "endLine": 484,
        "endChar": 30
      },
      "revId": "ba9aafd49efe1f80e87dc1f2bf65a3f1a70d78e8",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "10ec43d1_74af112c",
        "filename": "ssl/handoff.cc",
        "patchSetId": 3
      },
      "lineNbr": 572,
      "author": {
        "id": 5415
      },
      "writtenOn": "2019-12-09T20:34:11Z",
      "side": 1,
      "message": "I believe this works, but note that it only does because these are the first records sent and received at their particular epochs. Otherwise you need to synchronize the sequence numbers too.\n\n0-RTT may be interesting. We currently send those tickets (app data keys) half-RTT, though there\u0027s no particular guarantee that we do. I\u0027m not sure if it makes more sense to cut before the tickets or after. In all other modes, the ticket minting callback runs after handback, so cutting before may be better for consistency.",
      "revId": "ba9aafd49efe1f80e87dc1f2bf65a3f1a70d78e8",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c3cb2b42_85dc6044",
        "filename": "ssl/handoff.cc",
        "patchSetId": 3
      },
      "lineNbr": 572,
      "author": {
        "id": 5645
      },
      "writtenOn": "2019-12-10T21:21:09Z",
      "side": 1,
      "message": "\u003e I believe this works, but note that it only does because these are the first records sent and received at their particular epochs. Otherwise you need to synchronize the sequence numbers too.\n\nWould that look like setting s3-\u003eread_sequence and s3-\u003ewrite_sequence, as done above, in the handback_tls13 case?\n\n\u003e 0-RTT may be interesting. We currently send those tickets (app data keys) half-RTT, though there\u0027s no particular guarantee that we do. I\u0027m not sure if it makes more sense to cut before the tickets or after. In all other modes, the ticket minting callback runs after handback, so cutting before may be better for consistency.\n\nI\u0027m afraid I don\u0027t follow all that, because I\u0027ve postponed trying to understand 0RTT and early data in order to get something minimal working.  Can I leave this comment for later or does it have implications for the present commit?",
      "parentUuid": "10ec43d1_74af112c",
      "revId": "ba9aafd49efe1f80e87dc1f2bf65a3f1a70d78e8",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c424f509_6d2b6a24",
        "filename": "ssl/handoff.cc",
        "patchSetId": 3
      },
      "lineNbr": 572,
      "author": {
        "id": 5415
      },
      "writtenOn": "2019-12-16T19:05:46Z",
      "side": 1,
      "message": "\u003e Would that look like setting s3-\u003eread_sequence and s3-\u003ewrite_sequence, as done above, in the handback_tls13 case?\n\nYup.\n\n\u003e I\u0027m afraid I don\u0027t follow all that, because I\u0027ve postponed trying to understand 0RTT and early data in order to get something minimal working.  Can I leave this comment for later or does it have implications for the present commit?\n\nI think it\u0027s okay to ignore this. The possibilities are:\n\na) Go ahead and serialize read_sequence and write_sequence now.\nb) Wait until adding 0-RTT to serialize them.\nc) Don\u0027t bother serializing them and, for 0-RTT, send the ticket at the frontend side so we consistently send tickets on the same side. (But this may mean prodding at the half-RTT tickets mess.)",
      "parentUuid": "c3cb2b42_85dc6044",
      "revId": "ba9aafd49efe1f80e87dc1f2bf65a3f1a70d78e8",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212",
      "unresolved": true
    }
  ]
}