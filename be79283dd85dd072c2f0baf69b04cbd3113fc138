{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "126421b4_15683370",
        "filename": "rust/bssl-crypto/src/hmac.rs",
        "patchSetId": 50
      },
      "lineNbr": 30,
      "author": {
        "id": 5415
      },
      "writtenOn": "2023-03-14T22:05:55Z",
      "side": 1,
      "message": "I\u0027ve never seen anyone write it as `sha_256`, though the name does have a hyphen in it. Let\u0027s just use `hmac_sha256`. That\u0027s even what the tests call it.",
      "range": {
        "startLine": 30,
        "startChar": 15,
        "endLine": 30,
        "endChar": 19
      },
      "revId": "be79283dd85dd072c2f0baf69b04cbd3113fc138",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bc736831_a0b22ea9",
        "filename": "rust/bssl-crypto/src/hmac.rs",
        "patchSetId": 50
      },
      "lineNbr": 286,
      "author": {
        "id": 5415
      },
      "writtenOn": "2023-03-14T22:05:55Z",
      "side": 1,
      "message": "Where does this limit come from? `EVP_MAX_MD_BLOCK_SIZE` is the maximum over all block sizes we support. It might even change if we add a new `EVP_MD` with larger block size.\n\nCapping against the block size of the particular hash function would be coherent, but even that\u0027s wrong because HMAC is specified to take an arbitrary-size key. I think this can be removed, in which case the whole InvalidLength case and fallible creation can be removed.",
      "revId": "be79283dd85dd072c2f0baf69b04cbd3113fc138",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e9c44a72_b5bb3337",
        "filename": "rust/bssl-crypto/src/hmac.rs",
        "patchSetId": 50
      },
      "lineNbr": 286,
      "author": {
        "id": 5415
      },
      "writtenOn": "2023-03-14T22:09:59Z",
      "side": 1,
      "message": "\u003e the maximum over all block sizes we support\n\nSorry, that was unclear. It\u0027s the maximum block size over all EVP_MDs we support.\n\nThat is, this is just an upper-bound to aid callers in stack-allocating buffers that will definitely be large enough.",
      "parentUuid": "bc736831_a0b22ea9",
      "revId": "be79283dd85dd072c2f0baf69b04cbd3113fc138",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "76358d00_aa477fa1",
        "filename": "rust/bssl-crypto/src/lib.rs",
        "patchSetId": 50
      },
      "lineNbr": 43,
      "author": {
        "id": 5415
      },
      "writtenOn": "2023-03-14T21:21:30Z",
      "side": 1,
      "message": "I don\u0027t think this is right. BoringSSL APIs *typically* return 1 on success and 0 on *all* errors, allocation or otherwise. Or NULL vs non-NULL. Some functions only fail on allocation error *or programmer error*, in which case panicking makes sense.\n\nLikewise, while *must* functions return 0 on error, they don\u0027t all do so. Some functions have other return conventions due to OpenSSL compatibility. I wish it were more uniform, but we\u0027re stuck there. You need to check the documentation to see.\n\nThus injecting a `panic_if_error` method onto `i32` and `*mut T` is misleading and less safe. It suggests to the reader that we\u0027ve automatically already marked all the functions with a result type that knows about the return values of each function. Really all we\u0027re doing is just tagging the common one.\n\n`\"allocation failed!\"` is also not right because you may also have just failed a precondition.\n\nInstead, it seems to me a lower-tech strategy is both more straightforward and safer: just have a function analogous to C++ `CHECK` that takes a boolean and panicks on false. And then you can just write `check(HMAC_Update(...) \u003e 0)` or whatever. That clues to the reader that they must cross-reference the return value convention in the code with that of the function.",
      "revId": "be79283dd85dd072c2f0baf69b04cbd3113fc138",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5bdc0533_5bacf400",
        "filename": "rust/bssl-crypto/src/lib.rs",
        "patchSetId": 50
      },
      "lineNbr": 43,
      "author": {
        "id": 15751
      },
      "writtenOn": "2023-03-14T22:01:47Z",
      "side": 1,
      "message": "Good point, will take this is a followup cl since this is already merged. I was manually making sure each place this is used, does in fact follow that return convention, but I agree that would make it really easy to wrongly use these for future API\u0027s",
      "parentUuid": "76358d00_aa477fa1",
      "revId": "be79283dd85dd072c2f0baf69b04cbd3113fc138",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    }
  ]
}