{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "d256d2e9_ce09dd2c",
        "filename": "crypto/internal.h",
        "patchSetId": 5
      },
      "lineNbr": 552,
      "author": {
        "id": 5005
      },
      "writtenOn": "2023-05-15T20:50:08Z",
      "side": 1,
      "message": "removed",
      "range": {
        "startLine": 552,
        "startChar": 15,
        "endLine": 552,
        "endChar": 21
      },
      "revId": "dc36870a7f4ef2ec2a37768b0cc13a1d54ec1734",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a3d1c50f_09405098",
        "filename": "crypto/internal.h",
        "patchSetId": 5
      },
      "lineNbr": 552,
      "author": {
        "id": 5415
      },
      "writtenOn": "2023-05-15T23:28:12Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "d256d2e9_ce09dd2c",
      "range": {
        "startLine": 552,
        "startChar": 15,
        "endLine": 552,
        "endChar": 21
      },
      "revId": "dc36870a7f4ef2ec2a37768b0cc13a1d54ec1734",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9d88e940_1ba8a224",
        "filename": "crypto/refcount_win.c",
        "patchSetId": 5
      },
      "lineNbr": 1,
      "author": {
        "id": 5005
      },
      "writtenOn": "2023-05-15T20:50:08Z",
      "side": 1,
      "message": "2023",
      "range": {
        "startLine": 1,
        "startChar": 17,
        "endLine": 1,
        "endChar": 21
      },
      "revId": "dc36870a7f4ef2ec2a37768b0cc13a1d54ec1734",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f0c981a3_959e1924",
        "filename": "crypto/refcount_win.c",
        "patchSetId": 5
      },
      "lineNbr": 1,
      "author": {
        "id": 5415
      },
      "writtenOn": "2023-05-15T23:28:12Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "9d88e940_1ba8a224",
      "range": {
        "startLine": 1,
        "startChar": 17,
        "endLine": 1,
        "endChar": 21
      },
      "revId": "dc36870a7f4ef2ec2a37768b0cc13a1d54ec1734",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9863baa4_d30856fb",
        "filename": "crypto/refcount_win.c",
        "patchSetId": 5
      },
      "lineNbr": 26,
      "author": {
        "id": 5005
      },
      "writtenOn": "2023-05-15T20:50:08Z",
      "side": 1,
      "message": "size",
      "range": {
        "startLine": 26,
        "startChar": 53,
        "endLine": 26,
        "endChar": 62
      },
      "revId": "dc36870a7f4ef2ec2a37768b0cc13a1d54ec1734",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ccbf3c6c_3ee23320",
        "filename": "crypto/refcount_win.c",
        "patchSetId": 5
      },
      "lineNbr": 26,
      "author": {
        "id": 5415
      },
      "writtenOn": "2023-05-15T23:28:12Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "9863baa4_d30856fb",
      "range": {
        "startLine": 26,
        "startChar": 53,
        "endLine": 26,
        "endChar": 62
      },
      "revId": "dc36870a7f4ef2ec2a37768b0cc13a1d54ec1734",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "621f4c81_9d661149",
        "filename": "crypto/refcount_win.c",
        "patchSetId": 5
      },
      "lineNbr": 57,
      "author": {
        "id": 5005
      },
      "writtenOn": "2023-05-15T20:50:08Z",
      "side": 1,
      "message": "`desired` ?",
      "range": {
        "startLine": 57,
        "startChar": 25,
        "endLine": 57,
        "endChar": 37
      },
      "revId": "dc36870a7f4ef2ec2a37768b0cc13a1d54ec1734",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ecc8606a_3f1f1468",
        "filename": "crypto/refcount_win.c",
        "patchSetId": 5
      },
      "lineNbr": 57,
      "author": {
        "id": 5415
      },
      "writtenOn": "2023-05-15T23:28:12Z",
      "side": 1,
      "message": "I think this is correct, but now I\u0027m slightly worried, so please double-check me on this! :-)\n\n`atomic_compare_exchange` is meant to mirror the C11 function. The C11 function needs to return 1 iff `*expected` on function entry is equal to `*ptr` on function entry. (See Notes here.)\nhttps://en.cppreference.com/w/c/atomic/atomic_compare_exchange\n\n`InterlockedCompareExchange` returns the original value of `*ptr`. You have to infer whether the swap happened based on whether it matched `old_expected`.\nhttps://learn.microsoft.com/en-us/windows/win32/api/winnt/nf-winnt-interlockedcompareexchange\n\nThat is, I believe it\u0027s the atomic version of:\n```\nLONG InterlockedCompareExchange(\n  [in, out] LONG volatile *Destination,\n  [in]      LONG          ExChange,\n  [in]      LONG          Comparand\n) {\n    LONG InitialValue \u003d *Destination;\n    if (Comparand \u003d\u003d InitialValue) {\n        *Destination \u003d ExChange;\n    }\n    return InitialValue;\n}\n```\n\nAnd so we want to return one if `Comparand` (`old_expected`) matches the function\u0027s return value (`new_expected`).\n\n(Also I like how the docs can\u0027t decide if it\u0027s `Comperand` or `Comparand`.)",
      "parentUuid": "621f4c81_9d661149",
      "range": {
        "startLine": 57,
        "startChar": 25,
        "endLine": 57,
        "endChar": 37
      },
      "revId": "dc36870a7f4ef2ec2a37768b0cc13a1d54ec1734",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9c57f9e2_cfeb4621",
        "filename": "crypto/refcount_win.c",
        "patchSetId": 5
      },
      "lineNbr": 57,
      "author": {
        "id": 5005
      },
      "writtenOn": "2023-05-16T00:28:59Z",
      "side": 1,
      "message": "\"The function returns the initial value of the Destination parameter.\"[1]\n\nI think that\u0027s what I was missing. Seems like an odd choice to me, but that makes this line correct. Could you rename some of the variables here to be (arguably) clearer?\n\n`expected` -\u003e `expected32` (or `expected_u32`)\n`old_expected` -\u003e `expected`\n`new_expected` -\u003e `actual`\n\n[1] https://learn.microsoft.com/en-us/windows/win32/api/winnt/nf-winnt-interlockedcompareexchange#return-value",
      "parentUuid": "ecc8606a_3f1f1468",
      "range": {
        "startLine": 57,
        "startChar": 25,
        "endLine": 57,
        "endChar": 37
      },
      "revId": "dc36870a7f4ef2ec2a37768b0cc13a1d54ec1734",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d259224f_1b263adb",
        "filename": "crypto/refcount_win.c",
        "patchSetId": 5
      },
      "lineNbr": 57,
      "author": {
        "id": 5415
      },
      "writtenOn": "2023-05-16T18:34:30Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "9c57f9e2_cfeb4621",
      "range": {
        "startLine": 57,
        "startChar": 25,
        "endLine": 57,
        "endChar": 37
      },
      "revId": "dc36870a7f4ef2ec2a37768b0cc13a1d54ec1734",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "37badffd_b876382d",
        "filename": "crypto/refcount_win.c",
        "patchSetId": 5
      },
      "lineNbr": 82,
      "author": {
        "id": 5005
      },
      "writtenOn": "2023-05-15T20:50:08Z",
      "side": 1,
      "message": "in the prior function, `new_value` is `const`. I good with either, but they should be the same.",
      "revId": "dc36870a7f4ef2ec2a37768b0cc13a1d54ec1734",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "47195b06_5bf26b4f",
        "filename": "crypto/refcount_win.c",
        "patchSetId": 5
      },
      "lineNbr": 82,
      "author": {
        "id": 5415
      },
      "writtenOn": "2023-05-15T23:28:12Z",
      "side": 1,
      "message": "Made the other one `const` too, but I think I just got this from refcount_c11.c, which does the same thing. :-P",
      "parentUuid": "37badffd_b876382d",
      "revId": "dc36870a7f4ef2ec2a37768b0cc13a1d54ec1734",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    }
  ]
}