{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "38ef2e95_217daebc",
        "filename": "crypto/fipsmodule/aes/asm/aesni-x86_64.pl",
        "patchSetId": 3
      },
      "lineNbr": 1527,
      "author": {
        "id": 5415
      },
      "writtenOn": "2023-05-23T20:02:22Z",
      "side": 1,
      "message": "Actually, where are you getting 96 from? 96 \u003d 6 * 16, i.e. 6 blocks. But this code seems to process 8 blocks at a time.\n\n(Also a \"block\" is always 16 bytes for AES. This code is doing several blocks at a time.)\n\nI also notice that you\u0027re prefetching an address 3 three iterations in the future (3 * 0x80) and then another address 3.5 iterations. I take it then that prefetcht0 works in 4*16 \u003d 64-byte chunks? Three was chosen because that\u0027s how far ahead of the loop it\u0027s useful to be?",
      "range": {
        "startLine": 1527,
        "startChar": 33,
        "endLine": 1527,
        "endChar": 40
      },
      "revId": "56fcc7b36fda1fc134b628da5750429f33f5647f",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "00489912_e22ab6cc",
        "filename": "crypto/fipsmodule/aes/asm/aesni-x86_64.pl",
        "patchSetId": 3
      },
      "lineNbr": 1527,
      "author": {
        "id": 10131
      },
      "writtenOn": "2023-05-23T22:57:51Z",
      "side": 1,
      "message": "Thanks for catching this! I didn\u0027t see loads below and assumed that we process 6 blocks (from 0x0 to 0x50). Aligning this actually makes code faster! Updated the code and message (with new data). Prefetch0 prefetches 1 64-byte aligned line, so we need 2 for 128 byte.",
      "parentUuid": "38ef2e95_217daebc",
      "range": {
        "startLine": 1527,
        "startChar": 33,
        "endLine": 1527,
        "endChar": 40
      },
      "revId": "56fcc7b36fda1fc134b628da5750429f33f5647f",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8fcc6b0d_67db7fe9",
        "filename": "crypto/fipsmodule/aes/asm/aesni-x86_64.pl",
        "patchSetId": 3
      },
      "lineNbr": 1527,
      "author": {
        "id": 5415
      },
      "writtenOn": "2023-05-24T18:52:12Z",
      "side": 1,
      "message": "Nice! Just to confirm: we seem to currently be prefetching 4.5 loops ahead, so not quite aligned.\n\nThat is:\n* Iteration 1: read 0x80 bytes from `0($inp)`, prefix 0x80 bytes from `0x1c0($inp)`\n* Iteration 2: read 0x80 bytes from `0x80($inp)`, prefix 0x80 bytes from `0x240($inp)`\n* Iteration 3: read 0x80 bytes from `0x100($inp)`, prefix 0x80 bytes from `0x2c0($inp)`\n* Iteration 4: read 0x80 bytes from `0x180($inp)`, prefix 0x80 bytes from `0x340($inp)`\n* Iteration 5: read 0x80 bytes from `0x200($inp)`, prefix 0x80 bytes from `0x3c0($inp)`\n\n\nThat first round of prefetch hits the second half of iteration 4 and the first half of iteration 5.\n\nIs that intentional?",
      "parentUuid": "00489912_e22ab6cc",
      "range": {
        "startLine": 1527,
        "startChar": 33,
        "endLine": 1527,
        "endChar": 40
      },
      "revId": "56fcc7b36fda1fc134b628da5750429f33f5647f",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    }
  ]
}