{
  "comments": [
    {
      "key": {
        "uuid": "cffdacea_c2f54661",
        "filename": "ssl/ssl_lib.c",
        "patchSetId": 1
      },
      "lineNbr": 547,
      "author": {
        "id": 5005
      },
      "writtenOn": "2016-06-13T18:12:06Z",
      "side": 1,
      "message": "The situation is that this function is given a reference to each of rbio and wbio if they differ, but only one reference if they are the same, right?\n\nAnd its behaviour is that it adopts the reference only if ssl-\u003erbio/wbio is changed?\n\nIf so, all that should be nailed down in the comment.\n\nThen how about:\n\nif (rbio !\u003d SSL_get_rbio(ssl)) {\n  ssl_set_rbio(rbio);\n}\n\nif (wbio !\u003d SSL_get_wbio(ssl)) {\n  if (rbio \u003d\u003d wbio \u0026\u0026 wbio !\u003d NULL) {\n    /* Only one reference was granted in this case. */\n    BIO_up_ref(wbio);\n  }\n  ssl_set_wbio(wbio);\n}",
      "revId": "306d0c4bb909a4545ea89e3567166a94c40b4e55",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d43385f3_0fe969ee",
        "filename": "ssl/ssl_lib.c",
        "patchSetId": 1
      },
      "lineNbr": 547,
      "author": {
        "id": 5415
      },
      "writtenOn": "2016-06-14T17:55:29Z",
      "side": 1,
      "message": "Yeah, something like that. The two rules (one vs two references and change vs unchanged) interact somewhat though.\n\nAnd, actually, I think neither my version nor yours quite works. How many references get taken if I do:\n\n  SSL_set_bio(ssl, bio, NULL);\n  SSL_set_bio(ssl, bio, bio);\n\nalso:\n\n  SSL_set_bio(ssl, NULL, bio);\n  SSL_set_bio(ssl, bio, bio);\n\nThis isn\u0027t even hypothetical. Those are:\n\n  SSL_set_rfd(ssl, fd);\n  SSL_set_wfd(ssl, fd);\n\nand:\n\n  SSL_set_wfd(ssl, fd);\n  SSL_set_rfd(ssl, fd);\n\nWhich means I believe the answer should be that the second set_bio call takes zero references. Amazingly, the old code actually works in both cases here. I\u0027ll fiddle with this some more.",
      "parentUuid": "cffdacea_c2f54661",
      "revId": "306d0c4bb909a4545ea89e3567166a94c40b4e55",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212",
      "unresolved": false
    }
  ]
}